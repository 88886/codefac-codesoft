<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:ui="http://java.sun.com/jsf/facelets" 
                xmlns:p="http://primefaces.org/ui"
                template="/template/plantilladmin.xhtml">


    <ui:define name="contenido" >
        <div style="text-align: center"><h2>Gestion de Clientes</h2></div>
        <h:form id="form">
            <p:growl id="msgs" showDetail="true" />
            <p:panel id="panelTablaClientes" style="z-index: 0">
                <p:dataTable
                    style="height: 100%"
                    id="tablaClientes"
                    var="cliente" 
                    value="#{clienteMB.clientes}"
                    scrollable="true" 
                    selectionMode="single" 
                    rowKey="#{cliente.cedulaRuc}"
                    selection="#{clienteMB.clienteSeleccionado}">

                    <p:ajax event="rowSelect" listener="#{clienteMB.onRowSelect}" update=":form:msgs,btnEditarCliente"/>
                    <p:ajax event="rowUnselect" listener="#{clienteMB.onRowUnSelect}"/>



                    <f:facet name="header" >                               
                        <p:commandButton id="btnNuevoCliente" process="tablaClientes" icon="ui-icon-plus" onclick="PF('nuevoCliente').show();" actionListener="#{clienteMB.enCrear()}" style="width: 20px;height: 20px"/>  
                        <p:commandButton id="btnEditarCliente" process="tablaClientes" icon="ui-icon-pencil" onclick="PF('editarCliente').show();" actionListener="#{clienteMB.enModificar()}" disabled="#{clienteMB.flagBoton1}" style="width: 20px;height: 20px" update=":formDialogoEdit:panelGrid2"/>                          
                    </f:facet>


                    <p:column headerText="Cedula" filterBy="#{cliente.cedulaRuc}" filterMatchMode="contains" >
                        <h:outputText value="#{cliente.cedulaRuc}" />
                    </p:column>

                    <p:column headerText="Nombres" filterBy="#{cliente.nombre}"  filterFunction="#{clienteMB.filterByName}"  filterMatchMode="contains" footerText="contains" style="width:350px" >
                        <h:outputText value="#{cliente.nombre}"   />
                    </p:column>

                    <p:column headerText="Telefono" >
                        <h:outputText value="#{cliente.telefono}" />
                    </p:column>
                    <p:column headerText="Correo" >
                        <h:outputText value="#{cliente.correo}" />
                    </p:column>
                    <!--
                    <p:column headerText="Estado" >
                        <h:outputText value="#{cliente.devolverEstado()}" />
                    </p:column>-->
                    <p:column headerText="Dirección" >
                        <h:outputText value="#{cliente.direccion}" />
                    </p:column>


                    <p:column headerText="Acciones">
                        <p:commandButton  value="Eliminar" actionListener="#{clienteMB.eliminarDetalle(cliente)}" update="@form" >
                            <p:confirm header="Confirmation" message="Estas segura que quiere eliminar?" icon="ui-icon-alert" />
                        </p:commandButton>
                    </p:column>


                </p:dataTable>

                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                    <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                </p:confirmDialog>

            </p:panel>    

        </h:form>

        <h:form id="formDialogo">
            <!-- Dialogo para grabar un nuevo cliente -->
            <p:dialog  id="dlgCliente" header="Administracion Cliente" widgetVar="nuevoCliente" modal="true" height="auto">
                <p:panelGrid columns="3" id="panelGrid">   
                    <p:outputLabel for="cliCedula" value="Cédula:" />

                    <p:inputText id="cliCedula" value="#{clienteMB.cliente.cedulaRuc}" required="true" requiredMessage="Cedula necesario">
                        <p:ajax event="blur" listener="#{clienteMB.verificarClienteExiste()}"  />
                    </p:inputText>

                    <p:message for="cliCedula" />                  

                    <p:outputLabel for="cliNombre" value="Nombre:" />
                    <p:inputText id="cliNombre" value="#{clienteMB.cliente.nombre}" required="true" requiredMessage="Nombre necesario"/>
                    <p:message for="cliNombre" />                                

                    <p:outputLabel for="cliTelefono" value="Telefono:" />
                    <p:inputText id="cliTelefono" value="#{clienteMB.cliente.telefono}" required="true" requiredMessage="Telefono necesario"/>
                    <p:message for="cliTelefono" />                

                    <p:outputLabel for="cliDireccion" value="Direccion:" />
                    <p:inputText id="cliDireccion" value="#{clienteMB.cliente.direccion}" />
                    <p:message for="cliDireccion" />    

                    <p:outputLabel for="cliCorreo" value="Correo:" />
                    <p:inputText id="cliCorreo" value="#{clienteMB.cliente.correo}" />
                    <p:message for="cliCorreo" />  

                    <p:outputLabel  value="Tipo Cliente" />
                    <p:selectOneMenu id="tipoCliente" value="#{clienteMB.cliente.tipo}">
                        <f:selectItem itemLabel="Cliente Final" itemValue="Cliente Final" />
                        <f:selectItem itemLabel="Distribuidor" itemValue="Distribuidor" />
                    </p:selectOneMenu>
                    <p:message for="tipoCliente" /> 

                    <p:outputLabel for="notas" value="Notas" />
                    <p:inputTextarea id="notas" value="#{clienteMB.cliente.notas}" style="width: 250px;" readonly="#{pruebaBean.enDetalles}"/>
                    <p:message for="notas" />
                </p:panelGrid>

                <f:facet name="footer">
                    <p:commandButton 
                        value="Aceptar" 
                        icon="ui-icon-disk"
                        update=":form:tablaClientes,@form"
                        actionListener="#{clienteMB.registarCliente(e)}"/>
                    <p:commandButton value="Cancelar" icon="ui-icon-cancel" actionListener="#{clienteMB.cancelar()}" onclick="PF('nuevoCliente').hide();" update=":form:tablaClientes"/>                        
                </f:facet>

            </p:dialog>
        </h:form>

        <h:form id="formDialogoEdit"> 
            <!-- Dialogo para editar un cliente -->
            <p:dialog  id="dlgEditCliente" header="Editar Cliente" widgetVar="editarCliente" modal="true" height="auto">
                <p:panelGrid columns="3" id="panelGrid2">   
                    <p:outputLabel for="cliCedula2" value="Cédula:" />

                    <p:inputText id="cliCedula2" value="#{clienteMB.clienteSeleccionado.cedulaRuc}" required="true" requiredMessage="Cedula necesario">                        
                    </p:inputText>

                    <p:message for="cliCedula2" />                  

                    <p:outputLabel for="cliNombre2" value="Nombre:" />
                    <p:inputText id="cliNombre2" value="#{clienteMB.clienteSeleccionado.nombre}" required="true" requiredMessage="Nombre necesario"/>
                    <p:message for="cliNombre2" />                                

                    <p:outputLabel for="cliTelefono2" value="Telefono:" />
                    <p:inputText id="cliTelefono2" value="#{clienteMB.clienteSeleccionado.telefono}" required="true" requiredMessage="Telefono necesario"/>
                    <p:message for="cliTelefono2" />                

                    <p:outputLabel for="cliDireccion2" value="Direccion:" />
                    <p:inputText id="cliDireccion2" value="#{clienteMB.clienteSeleccionado.direccion}" />
                    <p:message for="cliDireccion2" />    

                    <p:outputLabel for="cliCorreo2" value="Correo:" />
                    <p:inputText id="cliCorreo2" value="#{clienteMB.clienteSeleccionado.correo}" />
                    <p:message for="cliCorreo2" />  

                    <p:outputLabel   value="Tipo Cliente" />
                    <p:selectOneMenu id="tipoCliente2" value="#{clienteMB.clienteSeleccionado.tipo}">
                        <f:selectItem itemLabel="Cliente Final" itemValue="Cliente Final" />
                        <f:selectItem itemLabel="Distribuidor" itemValue="Distribuidor" />
                    </p:selectOneMenu>
                    <p:message for="tipoCliente2" />
                    

                    <p:outputLabel for="notas2" value="Notas" />
                    <p:inputTextarea id="notas2" value="#{clienteMB.clienteSeleccionado.notas}" style="width: 250px;" readonly="#{pruebaBean.enDetalles}"/>
                    <p:message for="notas2" />
                </p:panelGrid>

                <f:facet name="footer">
                    <p:commandButton 
                        value="Aceptar" 
                        icon="ui-icon-disk"
                        update=":form:tablaClientes,@form"
                        actionListener="#{clienteMB.registarCliente(e)}"/>
                    
                    <p:commandButton value="Cancelar" icon="ui-icon-cancel" actionListener="#{clienteMB.cancelar()}" onclick="PF('editarCliente').hide();" update=":form:tablaClientes"/>                        
                </f:facet>

            </p:dialog>
        </h:form>
    </ui:define>
</ui:composition>