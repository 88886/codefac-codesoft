<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:ui="http://java.sun.com/jsf/facelets" 
                xmlns:p="http://primefaces.org/ui"
                xmlns:b="http://bootsfaces.net/ui"
                template="/template/plantillaEmpleado.xhtml">


    <ui:define name="contenido" >

        <p:panel header="Trabajos Pendientes"  >

            <h:form id="formPrincipal">                
                <p:accordionPanel >
                    <!-- panel que contiene los filtros aplicados a las ordenes de trabajo-->
                    <p:tab title="filtros">
                        <p:panelGrid columns="7" styleClass="panelNoBorder" >
                            <p:outputLabel value="Ordenar por:"/>

                            <p:selectOneMenu value="#{trabajosPendientesMB.tipoFiltro}"  style="width:200px">
                                <f:selectItem itemLabel="Fecha de ingreso" itemValue="ingreso" />
                                <f:selectItem itemLabel="Fecha de entrega" itemValue="entrega" />                                
                                <f:selectItem itemLabel="Precio" itemValue="precio" />
                                <p:ajax  event="change" listener="#{trabajosPendientesMB.filtrar()}" update=":formPrincipal:repeatOrdenTrabajo"/>
                            </p:selectOneMenu>

                            <p:selectOneMenu value="#{trabajosPendientesMB.tipoOrden}"  style="width:200px">
                                <f:selectItem itemLabel="Menor al Mayor" itemValue="ASC" />
                                <f:selectItem itemLabel="Mayor al Menor" itemValue="DESC" />
                                <p:ajax event="change" listener="#{trabajosPendientesMB.filtrar()}" update=":formPrincipal:repeatOrdenTrabajo"/>
                            </p:selectOneMenu>

                            <!--  -->
                            <p:selectOneMenu value="#{trabajosPendientesMB.tipoEstado}"  style="width:100px">
                                <f:selectItem itemLabel="Revision" itemValue="revision" />
                                <f:selectItem itemLabel="Reparados" itemValue="reparado" />
                                <p:ajax event="change" listener="#{trabajosPendientesMB.filtrar()}" update=":formPrincipal:repeatOrdenTrabajo"/>
                            </p:selectOneMenu>

                            <b:commandButton ajax="false" value="filtrar" actionListener="#{trabajosPendientesMB.filtrar()}" look="success" icon="glyphicon-triangle-right"/>
                            <b:commandButton ajax="false" value="Default"  look="warning" icon="glyphicon glyphicon-share"/>
                        </p:panelGrid>
                        <p:separator style="background-color: green;background-image: none" />
                    </p:tab>
                </p:accordionPanel>

                <!-- Listado de las ordenes de trabajo -->
                <ui:repeat id="repeatOrdenTrabajo" var="ordenTrabajo" value="#{trabajosPendientesMB.ordenTrabajoList}" >
                    <p:panelGrid columns="4" styleClass="panelNoBorder top-aligned-columns" >

                        <p:panelGrid columns="1">
                            <b:commandButton value="" title="Reparacion rapida" style="height: 50px" actionListener="#{trabajosPendientesMB.reparacionRapida(ordenTrabajo)}" update=":formReparacionRapida" look="primary" icon="glyphicon-wrench" size="lg" />                    
                            <b:commandButton value="" title="Reparacion detallada" style="height: 50px" actionListener="#{trabajosPendientesMB.reparacionRapida(ordenTrabajo)}" update=":formReparacionRapida"  look="info" icon="glyphicon-object-align-vertical" size="lg" />                    
                            <b:commandButton value="@" title="Enviar email" style="height: 50px" actionListener="#{trabajosPendientesMB.reparacionRapida(ordenTrabajo)}" update=":formReparacionRapida"  look="warning" size="lg" />                    
                        </p:panelGrid>
                        <p:panel >
                            <p:panelGrid columns="2" style="width: 270px">
                                <p:outputLabel value="Orden No:"/>
                                <p:outputLabel value="#{ordenTrabajo.idOrdenTrabajo}" style="font-weight: bold" />

                                <p:outputLabel value="Cedula:"/>
                                <p:outputLabel value="#{ordenTrabajo.cedulaRuc.cedulaRuc}" style="font-weight: bold" />

                                <p:outputLabel value="Nombres:"/>
                                <p:outputLabel value="#{ordenTrabajo.cedulaRuc.nombre}" style="font-weight: bold" />

                                <p:outputLabel value="Fecha Ingreso:"/>
                                <p:outputLabel value="#{ordenTrabajo.fechaEmision}" style="font-weight: bold" >
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                                </p:outputLabel>

                                <p:outputLabel value="Fecha Entrega:"/>
                                <p:outputLabel value="#{ordenTrabajo.fechaEntrega}" style="font-weight: bold" >
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                                </p:outputLabel>

                                <p:outputLabel value="Precio:"/>
                                <p:outputLabel value="#{ordenTrabajo.total}" style="font-weight: bold" />


                            </p:panelGrid>


                            <p:panel style="background-image: none;border-width: 2px;border-color:#{ordenTrabajo.diferenciaDiasEntrega() == 0?'darkorange':ordenTrabajo.diferenciaDiasEntrega() > 0?'darkcyan':'red'}">
                                <p:outputLabel value="#{ordenTrabajo.diferenciaDiasEntrega() >= 0 ? 'Tiempo Entrega:  ':'Tiempo Atraso:  '}" style="color: #000033;background-color: white;padding: 4px"/>
                                <p:outputLabel value="#{ordenTrabajo.tiempoEntrega()}" style="font-weight: bold;color: #000033;background-color: white;padding: 4px" >
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                                </p:outputLabel>
                            </p:panel>

                        </p:panel>
                        <p:dataTable 
                            value="#{ordenTrabajo.detalleOrdenTrabajoList}"
                            var="detalle"
                            >

                            <p:column headerText="Equipo">
                                <p:outputLabel value="#{detalle.equipo}" />
                            </p:column>

                            <p:column headerText="Descripcion">
                                <p:outputLabel value="#{detalle.descripcion}" />
                            </p:column>

                            <p:column headerText="Problema">
                                <p:outputLabel value="#{detalle.problema}" />
                            </p:column>

                            <p:column headerText="Trabajo Relizar">
                                <p:outputLabel value="#{detalle.trabajoRealizar}" />
                            </p:column>

                        </p:dataTable>

                    </p:panelGrid>
                    <p:separator />
                </ui:repeat>                     
            </h:form>

            <!-- Dialogo que me permite reparar la orden de trabajo-->
            <p:dialog header="Reparacion Rapida" modal="true" widgetVar="dlgReparacion" showEffect="explode" hideEffect="explode" height="2s00">
                <h:form id="formReparacionRapida">
                    <p:messages autoUpdate="true"/>
                    <p:panelGrid columns="3" styleClass="panelNoBorder">

                        <p:outputLabel value="Diagnostico:"/>
                        <p:inputTextarea 
                            required="true"
                            id="txtDiagnostico"
                            title="Diagostico del problema resulto por el tecnico"
                            value="#{trabajosPendientesMB.ordenTrabajoSeleccionados.diagnostico}">

                            <p:clientValidator event="keyup"/>
                        </p:inputTextarea>
                        <p:message for="txtDiagnostico" display="icon" />

                        <p:outputLabel value="Total:"/>
                        <p:inputText 
                            title="Costo total de la reparacion"
                            required="true"
                            id="txtTotal" 
                            value="#{trabajosPendientesMB.ordenTrabajoSeleccionados.total}" >

                            <p:clientValidator event="keyup"/>
                        </p:inputText>
                        <p:message for="txtTotal" display="icon" />

                        <p:outputLabel value="Destinatario:" />
                        <p:outputLabel value="#{trabajosPendientesMB.ordenTrabajoSeleccionados.cedulaRuc.correo}" style="font-weight: bold" />
                        <p:spacer/>

                        <h:outputText value="Enviar Correo:" />
                        <p:selectBooleanCheckbox value="#{trabajosPendientesMB.confirmarCorreo}"  />
                    </p:panelGrid>

                    <div style="text-align: center">
                        <p:commandButton 
                            onstart="PF('statusEnvioCorreo').show()" 
                            onsuccess="PF('statusEnvioCorreo').hide()"
                            actionListener="#{trabajosPendientesMB.grabarOrdenTrabajo()}" 
                            value="Terminar">

                            <p:confirm header="Confirmar" message="Esta seguro que quiere reparar?" icon="ui-icon-alert" />
                        </p:commandButton>
                    </div>


                    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                        <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                        <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                    </p:confirmDialog>

                </h:form>
            </p:dialog>

            <!-- Dialago para mostrar la espera del envio del correo  -->
            <p:dialog widgetVar="statusEnvioCorreo" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
                <p:panelGrid columns="2" styleClass="panelNoBorder">
                    <p:graphicImage library="img"  name="/util/waitIcon.gif" />
                    <p:outputLabel value="enviando correo ..." />
                </p:panelGrid>
            </p:dialog>
        </p:panel>
    </ui:define>
</ui:composition>